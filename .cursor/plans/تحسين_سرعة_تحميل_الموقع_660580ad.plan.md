---
name: تحسين سرعة تحميل الموقع
overview: تحسين سرعة تحميل البيانات في الموقع عبر تحسين نظام المصادقة، إزالة التأخيرات غير الضرورية، وإضافة prefetching للبيانات
todos:
  - id: optimize-auth-store
    content: "تحسين auth store: إزالة setTimeout، تحسين bootstrapAuth، وإضافة isInitializing منفصلة"
    status: completed
  - id: remove-unnecessary-delays
    content: إزالة mounted state check وتبسيط شروط العرض في الصفحة الرئيسية
    status: completed
  - id: improve-query-provider
    content: "تحسين إعدادات React Query: إضافة refetchOnMount: false وتحسين staleTime"
    status: completed
  - id: optimize-forms-hook
    content: "تحسين useForms hook: إضافة initialData support وتحسين enabled conditions"
    status: completed
  - id: improve-homepage-loading
    content: "تحسين الصفحة الرئيسية: عرض المحتوى بشكل تدريجي وتحسين loading states"
    status: completed
    dependencies:
      - optimize-auth-store
      - remove-unnecessary-delays
---

# خطة تحسين سرعة تحميل الموقع

## المشاكل المحددة

1. **تأخير في تحميل المصادقة**: نظام المصادقة يعتمد على localStorage ويستخدم `bootstrapAuth` الذي يضيف تأخيراً قبل عرض المحتوى
2. **فحوصات متعددة متتالية**: فحص `mounted` و `isHydrated` و `isAuthLoading` قبل عرض أي محتوى
3. **عدم وجود prefetching**: جميع البيانات تُحمّل على العميل فقط بعد mount
4. **مكونات العميل فقط**: جميع الصفحات تستخدم "use client" بدون server-side rendering

## الحلول المقترحة

### 1. تحسين نظام المصادقة ([src/lib/stores/auth-store.ts](src/lib/stores/auth-store.ts))

- إزالة `setTimeout` في `bootstrapAuth` وتشغيله مباشرة
- تحسين `onRehydrateStorage` لتشغيل bootstrap بشكل أسرع
- إضافة حالة `isInitializing` منفصلة عن `isLoading` لتجنب حجب المحتوى

### 2. إزالة التأخيرات غير الضرورية ([src/app/[locale]/page.tsx](src/app/[locale]/page.tsx))

- إزالة فحص `mounted` - غير ضروري مع Next.js
- تبسيط شروط عرض المحتوى لتقليل التأخير
- عرض المحتوى بشكل تدريجي بدلاً من حجب كل شيء

### 3. تحسين React Query ([src/components/providers/query-provider.tsx](src/components/providers/query-provider.tsx))

- إضافة `refetchOnMount: false` للاستعلامات الأولية
- تحسين `staleTime` و `gcTime` للتقليل من إعادة الجلب غير الضرورية
- إضافة prefetching للبيانات الأساسية

### 4. تحسين hooks البيانات ([src/lib/hooks/use-forms.ts](src/lib/hooks/use-forms.ts))

- إضافة `initialData` للاستعلامات عند توفرها
- تحسين `enabled` condition لتجنب انتظار غير ضروري
- إضافة optimistic updates للتحسينات السريعة

### 5. تحسين الصفحة الرئيسية ([src/app/[locale]/page.tsx](src/app/[locale]/page.tsx))

- إزالة `mounted` state check
- عرض Hero section فوراً بدون انتظار
- عرض Forms section بشكل تدريجي عند جاهزية البيانات
- تحسين loading states لتكون غير حاجبة

## الملفات التي سيتم تعديلها

1. `src/lib/stores/auth-store.ts` - تحسين bootstrap وhydration
2. `src/app/[locale]/page.tsx` - إزالة التأخيرات وتحسين العرض
3. `src/components/providers/query-provider.tsx` - تحسين إعدادات React Query
4. `src/lib/hooks/use-forms.ts` - إضافة initialData وتحسين enabled conditions
5. `src/lib/hooks/use-auth.ts` - تحسين return values إذا لزم الأمر

## النتائج المتوقعة

- تحميل أسرع للصفحة الرئيسية (تقليل الوقت من ~2-3 ثواني إلى <1 ثانية)
- عرض المحتوى فوراً بدون الحاجة لإعادة التحميل
- تحسين تجربة المستخدم مع loading states أفضل
- تقليل عدد الطلبات غير الضرورية للخادم